<html>
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
        <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
        <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    </head>

    <body style="margin: 0; overflow: hidden;">
        <a-scene
            embedded
            loading-screen="enabled: false;"
            arjs="sourceType: webcam; debugUIEnabled: false; trackingMethod: best;"
        >
            <a-assets>
                <video
                    src="assets/asset.mp4"
                    preload="auto"
                    id="vid"
                    response-type="arraybuffer"
                    loop
                    crossorigin
                    webkit-playsinline
                    muted
                    playsinline
                ></video>
            </a-assets>

            <!-- Aggiusta la posizione e la scala del video in modo che non si deformi -->
            <a-video
                src="#vid"
                position="0 0.1 0"
                rotation="-90 0 0"
                look-at="[gps-camera]"
                smooth="true"
                smoothCount="10"
                smoothTolerance="0.01"
                smoothThreshold="5"
                autoplay="true"
                scale="10 10 10"
                gps-entity-place="latitude: 42.89209809864697; longitude: 13.832430989164692;"
                visible="true"
            ></a-video>

            <a-camera gps-camera rotation-reader></a-camera>
        </a-scene>

        <script>
            document.addEventListener("DOMContentLoaded", function () {
                // Richiesta dei permessi per la fotocamera
                if (navigator.permissions) {
                    navigator.permissions.query({ name: 'camera' }).then(function (result) {
                        if (result.state === 'granted') {
                            console.log('Camera access granted');
                            startAR();
                        } else if (result.state === 'denied') {
                            alert('Permission for camera denied');
                        } else {
                            alert('Permission for camera is required');
                        }
                    });
                } else {
                    startAR();
                }
            });

            function startAR() {
                // Avvia la scena AR e il video
                var video = document.querySelector("#vid");
                if (video.paused) {
                    video.play();
                }
            }
        </script>
    </body>
</html>
